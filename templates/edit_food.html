<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Food - CAMPUSBITES</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    .form-container { max-width: 500px; margin: 2rem auto; background: #fff; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .form-container h2 { color: #ff7f50; text-align: center; margin-bottom: 1.5rem; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-weight: bold; margin-bottom: 0.4rem; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.8rem; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
    .form-group textarea { resize: vertical; }
    button { background-color: #ff7f50; color: white; border: none; padding: 0.9rem 1.5rem; font-size: 1rem; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; }
    button:hover { background-color: #ff5722; }
  </style>
</head>
<body class="home-body has-bottom-nav">
  <div class="form-container">
    <h2>Edit Food</h2>
    <form method="POST" enctype="multipart/form-data">
      <div class="form-group">
        <label for="name">Food Name</label>
        <input type="text" name="name" id="name" value="{{ food.name }}" required />
      </div>

      <div class="form-group">
        <label for="price">Price (â‚¹)</label>
        <input type="number" name="price" id="price" step="0.01" value="{{ food.price }}" required />
      </div>

      <div class="form-group">
        <label for="category">Category</label>
        <select name="category" id="category" required>
          <option value="breakfast" {% if food.category == 'breakfast' %}selected{% endif %}>Breakfast</option>
          <option value="lunch" {% if food.category == 'lunch' %}selected{% endif %}>Lunch</option>
        </select>
      </div>

      <div class="form-group">
        <label for="about">About</label>
        <textarea name="about" id="about" rows="3">{{ food.about }}</textarea>
      </div>

      <div class="form-group">
        <label>Available Days</label>
        <div style="display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:.25rem;">
          {% set d = (food.days or '') %}
          <label><input type="checkbox" name="days" value="mon" {% if 'mon' in d %}checked{% endif %}> Mon</label>
          <label><input type="checkbox" name="days" value="tue" {% if 'tue' in d %}checked{% endif %}> Tue</label>
          <label><input type="checkbox" name="days" value="wed" {% if 'wed' in d %}checked{% endif %}> Wed</label>
          <label><input type="checkbox" name="days" value="thu" {% if 'thu' in d %}checked{% endif %}> Thu</label>
          <label><input type="checkbox" name="days" value="fri" {% if 'fri' in d %}checked{% endif %}> Fri</label>
          <label><input type="checkbox" name="days" value="sat" {% if 'sat' in d %}checked{% endif %}> Sat</label>
          <label><input type="checkbox" name="days" value="sun" {% if 'sun' in d %}checked{% endif %}> Sun</label>
        </div>
      </div>

      <hr>

      <!-- Breakfast defaults -->
      <div class="form-group breakfast-default">
        <label for="default_breakfast_start">Default Breakfast Start</label>
        <input type="time" name="default_breakfast_start" id="default_breakfast_start"
               data-default="{{ (food.default_breakfast_start|string)[:5] if food.default_breakfast_start else '08:00' }}"
               value="{{ (food.default_breakfast_start|string)[:5] if food.default_breakfast_start else '08:00' }}">
      </div>
      <div class="form-group breakfast-default">
        <label for="default_breakfast_end">Default Breakfast End</label>
        <input type="time" name="default_breakfast_end" id="default_breakfast_end"
               data-default="{{ (food.default_breakfast_end|string)[:5] if food.default_breakfast_end else '11:00' }}"
               value="{{ (food.default_breakfast_end|string)[:5] if food.default_breakfast_end else '11:00' }}">
      </div>

      <!-- Lunch defaults -->
      <div class="form-group lunch-default">
        <label for="default_lunch_start">Default Lunch Start</label>
        <input type="time" name="default_lunch_start" id="default_lunch_start"
               data-default="{{ (food.default_lunch_start|string)[:5] if food.default_lunch_start else '12:00' }}"
               value="{{ (food.default_lunch_start|string)[:5] if food.default_lunch_start else '12:00' }}">
      </div>
      <div class="form-group lunch-default">
        <label for="default_lunch_end">Default Lunch End</label>
        <input type="time" name="default_lunch_end" id="default_lunch_end"
               data-default="{{ (food.default_lunch_end|string)[:5] if food.default_lunch_end else '15:00' }}"
               value="{{ (food.default_lunch_end|string)[:5] if food.default_lunch_end else '15:00' }}">
      </div>

      <div class="form-group">
        <label for="default_stock">Default Stock</label>
        <input type="number" name="default_stock" id="default_stock" value="{{ food.default_stock or 0 }}" min="0" required>
      </div>

      <div class="form-group">
        <label for="current-image">Current Image</label><br>
        {% if food.image %}
          <img src="{{ url_for('static', filename='uploads/' + food.image) }}" alt="Current Image" style="max-height: 100px; border-radius: 8px;">
        {% else %}
          No Image
        {% endif %}
      </div>

      <div class="form-group">
        <label for="image">Change Image (Optional)</label>
        <input type="file" name="image" id="image" accept="image/*" />
      </div>

      <div class="form-group">
        <label for="available">Availability</label>
        <select name="available" id="available">
          <option value="1" {% if food.available == 1 %}selected{% endif %}>Available</option>
          <option value="0" {% if food.available == 0 %}selected{% endif %}>Not Available</option>
        </select>
      </div>

      <button type="submit">Save Changes</button>
    </form>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const catSelect = document.querySelector('select[name="category"]');
  const breakfastFields = document.querySelectorAll('.breakfast-default');
  const lunchFields = document.querySelectorAll('.lunch-default');

  const breakfastStart = document.querySelector('input[name="default_breakfast_start"]');
  const breakfastEnd   = document.querySelector('input[name="default_breakfast_end"]');
  const lunchStart     = document.querySelector('input[name="default_lunch_start"]');
  const lunchEnd       = document.querySelector('input[name="default_lunch_end"]');

  function toggleFields() {
    const cat = catSelect.value;
    if (cat === 'breakfast') {
      breakfastFields.forEach(el => el.style.display = 'block');
      lunchFields.forEach(el => el.style.display = 'none');
      if (!breakfastStart.value) breakfastStart.value = breakfastStart.dataset.default || '08:00';
      if (!breakfastEnd.value) breakfastEnd.value = breakfastEnd.dataset.default || '11:00';
    } else {
      breakfastFields.forEach(el => el.style.display = 'none');
      lunchFields.forEach(el => el.style.display = 'block');
      if (!lunchStart.value) lunchStart.value = lunchStart.dataset.default || '12:00';
      if (!lunchEnd.value) lunchEnd.value = lunchEnd.dataset.default || '15:00';
    }
  }

  catSelect.addEventListener('change', toggleFields);
  toggleFields();
});
</script>

  </div>
</body>
</html>
